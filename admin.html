<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>åå°ç®¡ç† - ä½ç«¯å½±è§†</title>
    <script src="libs/tailwindcss.min.js"></script>
    <style>
        .loading { animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 min-h-screen text-white">
    <!-- ç™»å½•é¡µé¢ -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-slate-800/50 backdrop-blur-xl rounded-2xl p-8 w-full max-w-md border border-slate-700">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-gradient-to-br from-sky-500 to-cyan-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                    <span class="text-3xl">ğŸ¬</span>
                </div>
                <h1 class="text-2xl font-bold">ä½ç«¯å½±è§† åå°ç®¡ç†</h1>
                <p class="text-slate-400 mt-2">è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ç™»å½•</p>
            </div>
            <form onsubmit="handleLogin(event)">
                <input type="password" id="passwordInput" placeholder="ç®¡ç†å‘˜å¯†ç "
                    class="w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:border-sky-500 mb-4">
                <button type="submit" id="loginBtn"
                    class="w-full py-3 bg-gradient-to-r from-sky-500 to-cyan-500 hover:from-sky-600 hover:to-cyan-600 text-white rounded-xl font-medium transition-all">
                    ç™»å½•
                </button>
            </form>
            <p id="loginError" class="text-red-400 text-center mt-4 hidden"></p>
        </div>
    </div>

    <!-- ç®¡ç†é¢æ¿ -->
    <div id="adminPanel" class="hidden">
        <header class="bg-slate-800/80 backdrop-blur-xl border-b border-slate-700 sticky top-0 z-10">
            <div class="container mx-auto px-4 py-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-sky-500 to-cyan-500 rounded-xl flex items-center justify-center">
                        <span class="text-xl">ğŸ¬</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">åå°ç®¡ç†</h1>
                        <p class="text-xs text-slate-400">æ•°æ®åŒæ­¥ä¸ç®¡ç†</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <a href="/" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm transition-colors">è¿”å›é¦–é¡µ</a>
                    <button onclick="handleLogout()" class="px-4 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-lg text-sm transition-colors">é€€å‡ºç™»å½•</button>
                </div>
            </div>
        </header>

        <main class="container mx-auto px-4 py-8">
            <!-- åŒæ­¥çŠ¶æ€å¡ç‰‡ -->
            <div class="bg-slate-800/50 backdrop-blur-xl rounded-2xl p-6 border border-slate-700 mb-6">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                    <span>ğŸ“Š</span> åŒæ­¥çŠ¶æ€
                </h2>
                <div id="statusContent" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-slate-700/50 rounded-xl p-4 text-center">
                        <p class="text-slate-400 text-sm">çŠ¶æ€</p>
                        <p id="syncStatus" class="text-xl font-bold text-sky-400">-</p>
                    </div>
                    <div class="bg-slate-700/50 rounded-xl p-4 text-center">
                        <p class="text-slate-400 text-sm">è§†é¢‘æ€»æ•°</p>
                        <p id="totalVideos" class="text-xl font-bold text-green-400">-</p>
                    </div>
                    <div class="bg-slate-700/50 rounded-xl p-4 text-center">
                        <p class="text-slate-400 text-sm">åˆ†ç±»æ•°é‡</p>
                        <p id="totalCategories" class="text-xl font-bold text-purple-400">-</p>
                    </div>
                    <div class="bg-slate-700/50 rounded-xl p-4 text-center">
                        <p class="text-slate-400 text-sm">ä¸Šæ¬¡åŒæ­¥</p>
                        <p id="lastSync" class="text-xl font-bold text-orange-400">-</p>
                    </div>
                </div>
            </div>

            <!-- æ“ä½œåŒºåŸŸ -->
            <div class="bg-slate-800/50 backdrop-blur-xl rounded-2xl p-6 border border-slate-700">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                    <span>âš¡</span> æ•°æ®åŒæ­¥
                </h2>
                <p class="text-slate-400 mb-4">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ä»æ•°æ®æºæ‹‰å–æœ€æ–°æ•°æ®å¹¶æ›´æ–°ç¼“å­˜ã€‚åŒæ­¥è¿‡ç¨‹å¯èƒ½éœ€è¦ 1-2 åˆ†é’Ÿã€‚</p>
                <button onclick="handleSync()" id="syncBtn"
                    class="px-6 py-3 bg-gradient-to-r from-sky-500 to-cyan-500 hover:from-sky-600 hover:to-cyan-600 text-white rounded-xl font-medium transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                    <span id="syncIcon">ğŸ”„</span>
                    <span id="syncText">ç«‹å³åŒæ­¥</span>
                </button>
                <p id="syncResult" class="mt-4 text-sm hidden"></p>
            </div>
        </main>
    </div>

    <script>
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        async function checkAuth() {
            try {
                const res = await fetch('/api/admin/verify');
                const data = await res.json();
                if (data.authenticated) {
                    showAdminPanel();
                    loadStatus();
                }
            } catch (e) { console.error(e); }
        }

        // æ˜¾ç¤ºç®¡ç†é¢æ¿
        function showAdminPanel() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('hidden');
        }

        // ç™»å½•
        async function handleLogin(e) {
            e.preventDefault();
            const password = document.getElementById('passwordInput').value;
            const errorEl = document.getElementById('loginError');
            const btn = document.getElementById('loginBtn');
            
            btn.disabled = true;
            btn.textContent = 'ç™»å½•ä¸­...';
            errorEl.classList.add('hidden');

            try {
                const res = await fetch('/api/admin/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });
                const data = await res.json();
                if (res.ok) {
                    showAdminPanel();
                    loadStatus();
                } else {
                    errorEl.textContent = data.error || 'ç™»å½•å¤±è´¥';
                    errorEl.classList.remove('hidden');
                }
            } catch (err) {
                errorEl.textContent = 'ç½‘ç»œé”™è¯¯';
                errorEl.classList.remove('hidden');
            }
            btn.disabled = false;
            btn.textContent = 'ç™»å½•';
        }

        // é€€å‡ºç™»å½•
        async function handleLogout() {
            await fetch('/api/admin/logout');
            location.reload();
        }

        // åŠ è½½çŠ¶æ€
        async function loadStatus() {
            try {
                const res = await fetch('/api/admin/status');
                const data = await res.json();
                if (data.success && data.data) {
                    const s = data.data;
                    document.getElementById('syncStatus').textContent =
                        s.status === 'success' ? 'âœ… æˆåŠŸ' :
                        s.status === 'syncing' ? 'ğŸ”„ åŒæ­¥ä¸­' :
                        s.status === 'error' ? 'âŒ å¤±è´¥' : 'â³ æœªåŒæ­¥';
                    document.getElementById('totalVideos').textContent = s.totalVideos || '-';
                    document.getElementById('totalCategories').textContent = s.categories || '-';
                    document.getElementById('lastSync').textContent = s.lastSync
                        ? new Date(s.lastSync).toLocaleString('zh-CN') : '-';
                }
            } catch (e) { console.error(e); }
        }

        // æ‰§è¡ŒåŒæ­¥
        async function handleSync() {
            const btn = document.getElementById('syncBtn');
            const icon = document.getElementById('syncIcon');
            const text = document.getElementById('syncText');
            const result = document.getElementById('syncResult');

            btn.disabled = true;
            icon.classList.add('loading');
            text.textContent = 'åŒæ­¥ä¸­...';
            result.classList.add('hidden');

            try {
                const res = await fetch('/api/admin/sync', { method: 'POST' });
                const data = await res.json();

                if (data.success) {
                    result.textContent = `âœ… åŒæ­¥æˆåŠŸï¼å…± ${data.totalVideos} æ¡è§†é¢‘ï¼Œ${data.categories} ä¸ªåˆ†ç±»ï¼Œè€—æ—¶ ${(data.duration/1000).toFixed(1)} ç§’`;
                    result.className = 'mt-4 text-sm text-green-400';
                } else {
                    result.textContent = `âŒ åŒæ­¥å¤±è´¥: ${data.error}`;
                    result.className = 'mt-4 text-sm text-red-400';
                }
                result.classList.remove('hidden');
                loadStatus();
            } catch (err) {
                result.textContent = `âŒ ç½‘ç»œé”™è¯¯: ${err.message}`;
                result.className = 'mt-4 text-sm text-red-400';
                result.classList.remove('hidden');
            }

            btn.disabled = false;
            icon.classList.remove('loading');
            text.textContent = 'ç«‹å³åŒæ­¥';
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•
        checkAuth();
    </script>
</body>
</html>

